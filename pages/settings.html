<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Smart Study Planner</title>
    
    <!-- Favicon -->
     <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation Header -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Smart Study Planner</span>
            </div>
            <div class="nav-menu">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="create-plan.html" class="nav-link">Create Plan</a>
                <a href="view-plans.html" class="nav-link">All Plans</a>
                <a href="settings.html" class="nav-link active">Settings</a>
            </div>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="settings-main">
        <div class="container">
            <!-- Page Header -->
            <header class="page-header">
                <div class="header-content">
                    <h1 class="page-title">
                        <i class="fas fa-cog"></i>
                        Settings & Preferences
                    </h1>
                    <p class="page-subtitle">
                        Customize your study planner experience with personalized settings and preferences.
                    </p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="saveAllSettings()">
                        <i class="fas fa-save"></i>
                        Save All Changes
                    </button>
                </div>
            </header>

            <!-- Settings Navigation -->
            <div class="settings-layout">
                <aside class="settings-sidebar">
                    <nav class="settings-nav">
                        <a href="#general" class="settings-nav-item active" onclick="switchSettingsTab('general', this)">
                            <i class="fas fa-user"></i>
                            <span>General</span>
                        </a>
                        <a href="#notifications" class="settings-nav-item" onclick="switchSettingsTab('notifications', this)">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </a>
                        <a href="#appearance" class="settings-nav-item" onclick="switchSettingsTab('appearance', this)">
                            <i class="fas fa-palette"></i>
                            <span>Appearance</span>
                        </a>
                        <a href="#study" class="settings-nav-item" onclick="switchSettingsTab('study', this)">
                            <i class="fas fa-book"></i>
                            <span>Study Preferences</span>
                        </a>
                        <a href="#data" class="settings-nav-item" onclick="switchSettingsTab('data', this)">
                            <i class="fas fa-database"></i>
                            <span>Data Management</span>
                        </a>
                        <a href="#privacy" class="settings-nav-item" onclick="switchSettingsTab('privacy', this)">
                            <i class="fas fa-shield-alt"></i>
                            <span>Privacy & Security</span>
                        </a>
                        <a href="#about" class="settings-nav-item" onclick="switchSettingsTab('about', this)">
                            <i class="fas fa-info-circle"></i>
                            <span>About</span>
                        </a>
                    </nav>
                </aside>

                <main class="settings-content">
                    <!-- General Settings -->
                    <section id="general-settings" class="settings-section active">
                        <div class="settings-header">
                            <h2>
                                <i class="fas fa-user"></i>
                                General Settings
                            </h2>
                            <p>Manage your basic profile and application preferences</p>
                        </div>

                        <div class="settings-groups">
                            <div class="settings-group">
                                <h3>Profile Information</h3>
                                <div class="form-group">
                                    <label for="userName" class="form-label">Display Name</label>
                                    <input type="text" id="userName" class="form-input" placeholder="Enter your name">
                                    <small class="form-help">This name will appear in your study plans and statistics</small>
                                </div>
                                <div class="form-group">
                                    <label for="userTimezone" class="form-label">Timezone</label>
                                    <select id="userTimezone" class="form-select">
                                        <!-- Timezone options will be populated by JavaScript -->
                                    </select>
                                    <small class="form-help">Used for scheduling reminders and deadlines</small>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Language & Region</h3>
                                <div class="form-group">
                                    <label for="language" class="form-label">Language</label>
                                    <select id="language" class="form-select">
                                        <option value="en">English</option>
                                        <option value="es">Español</option>
                                        <option value="fr">Français</option>
                                        <option value="de">Deutsch</option>
                                        <option value="hi">हिन्दी</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="dateFormat" class="form-label">Date Format</label>
                                    <select id="dateFormat" class="form-select">
                                        <option value="MM/DD/YYYY">MM/DD/YYYY (US)</option>
                                        <option value="DD/MM/YYYY">DD/MM/YYYY (International)</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD (ISO)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Default Study Plan Settings</h3>
                                <div class="form-group">
                                    <label for="defaultPriority" class="form-label">Default Priority</label>
                                    <select id="defaultPriority" class="form-select">
                                        <option value="low">Low Priority</option>
                                        <option value="medium" selected>Medium Priority</option>
                                        <option value="high">High Priority</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="defaultReminderTime" class="form-label">Default Reminder Time</label>
                                    <select id="defaultReminderTime" class="form-select">
                                        <option value="8">8:00 AM</option>
                                        <option value="12">12:00 PM</option>
                                        <option value="15">3:00 PM</option>
                                        <option value="18" selected>6:00 PM</option>
                                        <option value="20">8:00 PM</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Notification Settings -->
                    <section id="notifications-settings" class="settings-section">
                        <div class="settings-header">
                            <h2>
                                <i class="fas fa-bell"></i>
                                Notification Settings
                            </h2>
                            <p>Configure when and how you receive study reminders and notifications</p>
                        </div>

                        <div class="settings-groups">
                            <div class="settings-group">
                                <h3>Browser Notifications</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="enableBrowserNotifications">Enable Browser Notifications</label>
                                        <p>Receive notifications even when the app is not active</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="enableBrowserNotifications">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="enableSounds">Notification Sounds</label>
                                        <p>Play sound alerts for notifications</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="enableSounds">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Reminder Types</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="dailyReminders">Daily Study Reminders</label>
                                        <p>Get reminded to study at your scheduled time</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="dailyReminders" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="deadlineReminders">Deadline Reminders</label>
                                        <p>Get notified when deadlines are approaching</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="deadlineReminders" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="milestoneReminders">Milestone Reminders</label>
                                        <p>Celebrate when you reach study milestones</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="milestoneReminders" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="encouragementNotifications">Encouragement Notifications</label>
                                        <p>Receive motivational messages and progress updates</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="encouragementNotifications" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Quiet Hours</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="enableQuietHours">Enable Quiet Hours</label>
                                        <p>Pause notifications during specific times</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="enableQuietHours">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="quiet-hours-settings" id="quietHoursSettings" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="quietHoursStart" class="form-label">Start Time</label>
                                            <select id="quietHoursStart" class="form-select">
                                                <!-- Time options will be populated by JavaScript -->
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="quietHoursEnd" class="form-label">End Time</label>
                                            <select id="quietHoursEnd" class="form-select">
                                                <!-- Time options will be populated by JavaScript -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Appearance Settings -->
                    <section id="appearance-settings" class="settings-section">
                        <div class="settings-header">
                            <h2>
                                <i class="fas fa-palette"></i>
                                Appearance Settings
                            </h2>
                            <p>Customize the look and feel of your study planner</p>
                        </div>

                        <div class="settings-groups">
                            <div class="settings-group">
                                <h3>Theme</h3>
                                <div class="theme-selector">
                                    <div class="theme-option" data-theme="light">
                                        <div class="theme-preview light-theme">
                                            <div class="preview-header"></div>
                                            <div class="preview-sidebar"></div>
                                            <div class="preview-content"></div>
                                        </div>
                                        <label>
                                            <input type="radio" name="theme" value="light" checked>
                                            Light Theme
                                        </label>
                                    </div>
                                    <div class="theme-option" data-theme="dark">
                                        <div class="theme-preview dark-theme">
                                            <div class="preview-header"></div>
                                            <div class="preview-sidebar"></div>
                                            <div class="preview-content"></div>
                                        </div>
                                        <label>
                                            <input type="radio" name="theme" value="dark">
                                            Dark Theme
                                        </label>
                                    </div>
                                    <div class="theme-option" data-theme="auto">
                                        <div class="theme-preview auto-theme">
                                            <div class="preview-header"></div>
                                            <div class="preview-sidebar"></div>
                                            <div class="preview-content"></div>
                                        </div>
                                        <label>
                                            <input type="radio" name="theme" value="auto">
                                            Auto (System)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Display Options</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="compactMode">Compact Mode</label>
                                        <p>Show more content in less space</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="compactMode">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="animationsEnabled">Enable Animations</label>
                                        <p>Show smooth transitions and effects</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="animationsEnabled" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Timeline Preferences</h3>
                                <div class="form-group">
                                    <label for="defaultTimelineView" class="form-label">Default Timeline View</label>
                                    <select id="defaultTimelineView" class="form-select">
                                        <option value="week">Week View</option>
                                        <option value="month" selected>Month View</option>
                                        <option value="quarter">Quarter View</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="showCompletedTasks">Show Completed Tasks</label>
                                        <p>Display completed tasks in timelines</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="showCompletedTasks" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Study Preferences -->
                    <section id="study-settings" class="settings-section">
                        <div class="settings-header">
                            <h2>
                                <i class="fas fa-book"></i>
                                Study Preferences
                            </h2>
                            <p>Customize your study habits and tracking preferences</p>
                        </div>

                        <div class="settings-groups">
                            <div class="settings-group">
                                <h3>Study Goals</h3>
                                <div class="form-group">
                                    <label for="dailyStudyGoal" class="form-label">Daily Study Goal (hours)</label>
                                    <input type="number" id="dailyStudyGoal" class="form-input" min="0.5" max="12" step="0.5" value="2">
                                    <small class="form-help">Your target study hours per day</small>
                                </div>
                                <div class="form-group">
                                    <label for="weeklyStudyGoal" class="form-label">Weekly Study Goal (hours)</label>
                                    <input type="number" id="weeklyStudyGoal" class="form-input" min="1" max="80" step="1" value="14">
                                    <small class="form-help">Your target study hours per week</small>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Preferred Study Methods</h3>
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="preferredMethods" value="reading" checked>
                                        <span class="checkmark"></span>
                                        Reading & Note-taking
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="preferredMethods" value="practice">
                                        <span class="checkmark"></span>
                                        Practice Problems
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="preferredMethods" value="videos">
                                        <span class="checkmark"></span>
                                        Video Tutorials
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="preferredMethods" value="flashcards">
                                        <span class="checkmark"></span>
                                        Flashcards
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="preferredMethods" value="group">
                                        <span class="checkmark"></span>
                                        Group Study
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="preferredMethods" value="projects">
                                        <span class="checkmark"></span>
                                        Hands-on Projects
                                    </label>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Progress Tracking</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="trackStudyTime">Track Study Time</label>
                                        <p>Monitor how much time you spend studying</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="trackStudyTime" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="showProgressBadges">Show Achievement Badges</label>
                                        <p>Display badges for milestones and streaks</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="showProgressBadges" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Data Management -->
                    <section id="data-settings" class="settings-section">
                        <div class="settings-header">
                            <h2>
                                <i class="fas fa-database"></i>
                                Data Management
                            </h2>
                            <p>Import, export, and manage your study planner data</p>
                        </div>

                        <div class="settings-groups">
                            <div class="settings-group">
                                <h3>Export Data</h3>
                                <p class="group-description">Download your study plans and progress data for backup or transfer to another device.</p>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="exportAllData()">
                                        <i class="fas fa-download"></i>
                                        Export All Data
                                    </button>
                                    <button class="btn btn-secondary" onclick="exportPlansOnly()">
                                        <i class="fas fa-file-export"></i>
                                        Export Plans Only
                                    </button>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Import Data</h3>
                                <p class="group-description">Restore your data from a previously exported backup file.</p>
                                <div class="import-area">
                                    <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleImportFile(this)">
                                    <button class="btn btn-secondary" onclick="document.getElementById('importFileInput').click()">
                                        <i class="fas fa-upload"></i>
                                        Choose Import File
                                    </button>
                                    <div class="import-status" id="importStatus"></div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Storage Information</h3>
                                <div class="storage-stats" id="storageStats">
                                    <div class="stat-item">
                                        <label>Total Storage Used</label>
                                        <span id="storageUsed">Calculating...</span>
                                    </div>
                                    <div class="stat-item">
                                        <label>Number of Study Plans</label>
                                        <span id="planCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <label>Last Backup</label>
                                        <span id="lastBackup">Never</span>
                                    </div>
                                </div>
                                <button class="btn btn-info" onclick="refreshStorageStats()">
                                    <i class="fas fa-sync-alt"></i>
                                    Refresh Stats
                                </button>
                            </div>

                            <div class="settings-group danger-zone">
                                <h3>Clear Data</h3>
                                <p class="group-description warning">⚠️ Warning: These actions cannot be undone. Make sure to export your data first.</p>
                                <div class="action-buttons">
                                    <button class="btn btn-warning" onclick="clearCompletedPlans()">
                                        <i class="fas fa-broom"></i>
                                        Clear Completed Plans
                                    </button>
                                    <button class="btn" style="background-color: var(--error); color: var(--white);" onclick="clearAllData()">
                                        <i class="fas fa-trash-alt"></i>
                                        Clear All Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Privacy & Security -->
                    <section id="privacy-settings" class="settings-section">
                        <div class="settings-header">
                            <h2>
                                <i class="fas fa-shield-alt"></i>
                                Privacy & Security
                            </h2>
                            <p>Manage your privacy settings and understand data handling</p>
                        </div>

                        <div class="settings-groups">
                            <div class="settings-group">
                                <h3>Data Privacy</h3>
                                <div class="privacy-info">
                                    <div class="info-card">
                                        <i class="fas fa-lock info-icon"></i>
                                        <div class="info-content">
                                            <h4>Local Storage Only</h4>
                                            <p>All your study plans and personal data are stored locally on your device. No data is sent to external servers.</p>
                                        </div>
                                    </div>
                                    <div class="info-card">
                                        <i class="fas fa-user-shield info-icon"></i>
                                        <div class="info-content">
                                            <h4>No Account Required</h4>
                                            <p>You don't need to create an account or provide personal information to use this application.</p>
                                        </div>
                                    </div>
                                    <div class="info-card">
                                        <i class="fas fa-eye-slash info-icon"></i>
                                        <div class="info-content">
                                            <h4>No Tracking</h4>
                                            <p>We don't track your usage or collect analytics data about your study habits.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Browser Permissions</h3>
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <h4>Notifications</h4>
                                        <p>Used to send study reminders and deadline alerts</p>
                                    </div>
                                    <div class="permission-status" id="notificationPermission">
                                        <span class="status-badge">Checking...</span>
                                        <button class="btn btn-sm btn-secondary" onclick="requestNotificationPermission()">
                                            Enable
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Session Security</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label for="autoLogout">Auto-save Changes</label>
                                        <p>Automatically save changes as you make them</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="autoSave" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- About -->
                    <section id="about-settings" class="settings-section">
                        <div class="settings-header">
                            <h2>
                                <i class="fas fa-info-circle"></i>
                                About Smart Study Planner
                            </h2>
                            <p>Information about the application and helpful resources</p>
                        </div>

                        <div class="settings-groups">
                            <div class="settings-group">
                                <div class="about-app">
                                    <div class="app-logo">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div class="app-info">
                                        <h3>Smart Study Planner</h3>
                                        <p class="version">Version 1.0.0</p>
                                        <p class="description">
                                            A comprehensive study planning tool designed to help students organize their academic goals, 
                                            track progress with visual timelines, and stay motivated with intelligent reminders.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Features</h3>
                                <div class="features-list">
                                    <div class="feature-item">
                                        <i class="fas fa-tasks"></i>
                                        <span>Create and manage study plans with tasks</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-chart-line"></i>
                                        <span>Visual progress tracking with timelines</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-bell"></i>
                                        <span>Smart reminders and notifications</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-mobile-alt"></i>
                                        <span>Fully responsive design for all devices</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-save"></i>
                                        <span>Local data storage for privacy</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Technical Information</h3>
                                <div class="tech-info">
                                    <div class="tech-item">
                                        <label>Built with:</label>
                                        <span>HTML5, CSS3, JavaScript</span>
                                    </div>
                                    <div class="tech-item">
                                        <label>Data Storage:</label>
                                        <span>Browser Local Storage</span>
                                    </div>
                                    <div class="tech-item">
                                        <label>Compatibility:</label>
                                        <span>Modern browsers (Chrome, Firefox, Safari, Edge)</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3>Keyboard Shortcuts</h3>
                                <div class="shortcuts-list">
                                    <div class="shortcut-item">
                                        <kbd>Ctrl</kbd> + <kbd>N</kbd>
                                        <span>Create new study plan</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <kbd>Ctrl</kbd> + <kbd>F</kbd>
                                        <span>Search study plans</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <kbd>Ctrl</kbd> + <kbd>S</kbd>
                                        <span>Save current changes</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <kbd>Escape</kbd>
                                        <span>Close modals/cancel actions</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </div>
    </main>

    <!-- Confirmation Modals -->
    <div class="modal-overlay" id="resetConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Reset to Defaults</h3>
                <button class="modal-close" onclick="studyApp.closeModal('resetConfirmModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reset all settings to their default values?</p>
                <p>This will not affect your study plans or data.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="studyApp.closeModal('resetConfirmModal')">Cancel</button>
                <button class="btn btn-warning" onclick="confirmResetSettings()">Reset Settings</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="clearDataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Clear All Data</h3>
                <button class="modal-close" onclick="studyApp.closeModal('clearDataModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>⚠️ Warning: This action cannot be undone!</strong></p>
                <p>This will permanently delete:</p>
                <ul>
                    <li>All study plans and tasks</li>
                    <li>Progress data and statistics</li>
                    <li>Settings and preferences</li>
                    <li>All stored data in this browser</li>
                </ul>
                <p>Make sure you have exported your data if you want to keep it.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="studyApp.closeModal('clearDataModal')">Cancel</button>
                <button class="btn" style="background-color: var(--error); color: var(--white);" onclick="confirmClearAllData()">
                    Clear All Data
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="../js/app.js"></script>
    <script src="../js/localStorage.js"></script>
    <script src="../js/studyPlan.js"></script>
    <script src="../js/notifications.js"></script>
    <script>
        // Global variables
        let currentSettingsTab = 'general';
        let hasUnsavedChanges = false;

        // Initialize settings page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Settings page loaded');
            initializeSettings();
        });

        // Initialize all settings
        function initializeSettings() {
            loadAllSettings();
            setupEventListeners();
            populateTimeSelects();
            populateTimezoneSelect();
            checkBrowserPermissions();
            updateStorageStats();
        }

        // Load all settings from storage
        function loadAllSettings() {
            const settings = studyApp.settings || {};
            
            // General settings
            document.getElementById('userName').value = settings.userName || '';
            document.getElementById('language').value = settings.language || 'en';
            document.getElementById('dateFormat').value = settings.dateFormat || 'MM/DD/YYYY';
            document.getElementById('defaultPriority').value = settings.defaultPriority || 'medium';
            document.getElementById('defaultReminderTime').value = settings.defaultReminderTime || 18;
            
            // Notification settings
            document.getElementById('enableBrowserNotifications').checked = settings.notifications !== false;
            document.getElementById('enableSounds').checked = settings.soundEnabled !== false;
            document.getElementById('dailyReminders').checked = settings.dailyReminders !== false;
            document.getElementById('deadlineReminders').checked = settings.deadlineReminders !== false;
            document.getElementById('milestoneReminders').checked = settings.milestoneReminders !== false;
            document.getElementById('encouragementNotifications').checked = settings.encouragementNotifications !== false;
            
            // Quiet hours
            const quietHours = settings.quietHours || {};
            document.getElementById('enableQuietHours').checked = quietHours.enabled || false;
            document.getElementById('quietHoursStart').value = quietHours.start || 22;
            document.getElementById('quietHoursEnd').value = quietHours.end || 8;
            toggleQuietHoursSettings(quietHours.enabled);
            
            // Appearance settings
            const theme = settings.theme || 'light';
            document.querySelector(`input[name="theme"][value="${theme}"]`).checked = true;
            document.getElementById('compactMode').checked = settings.compactMode || false;
            document.getElementById('animationsEnabled').checked = settings.animationsEnabled !== false;
            document.getElementById('defaultTimelineView').value = settings.defaultTimelineView || 'month';
            document.getElementById('showCompletedTasks').checked = settings.showCompletedTasks !== false;
            
            // Study preferences
            document.getElementById('dailyStudyGoal').value = settings.dailyStudyGoal || 2;
            document.getElementById('weeklyStudyGoal').value = settings.weeklyStudyGoal || 14;
            document.getElementById('trackStudyTime').checked = settings.trackStudyTime !== false;
            document.getElementById('showProgressBadges').checked = settings.showProgressBadges !== false;
            
            // Load preferred methods
            const preferredMethods = settings.preferredMethods || ['reading'];
            document.querySelectorAll('input[name="preferredMethods"]').forEach(checkbox => {
                checkbox.checked = preferredMethods.includes(checkbox.value);
            });
            
            // Privacy settings
            document.getElementById('autoSave').checked = settings.autoSave !== false;
            
            console.log('Settings loaded successfully');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Theme change listeners
            document.querySelectorAll('input[name="theme"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        applyTheme(this.value);
                        markUnsavedChanges();
                    }
                });
            });
            
            // Quiet hours toggle
            document.getElementById('enableQuietHours').addEventListener('change', function() {
                toggleQuietHoursSettings(this.checked);
                markUnsavedChanges();
            });
            
            // Mark changes as unsaved when any input changes
            document.querySelectorAll('input, select, textarea').forEach(element => {
                element.addEventListener('change', markUnsavedChanges);
            });
            
            // Warn about unsaved changes
            window.addEventListener('beforeunload', function(e) {
                if (hasUnsavedChanges) {
                    e.preventDefault();
                    e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                    return e.returnValue;
                }
            });
        }

        // Switch settings tabs
        function switchSettingsTab(tabName, element) {
            // Update active nav item
            document.querySelectorAll('.settings-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
            
            // Show/hide sections
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(tabName + '-settings').classList.add('active');
            
            currentSettingsTab = tabName;
        }

        // Mark settings as having unsaved changes
        function markUnsavedChanges() {
            hasUnsavedChanges = true;
            // Visual indicator could be added here
        }

        // Save all settings
        function saveAllSettings() {
            const settings = {
                // General
                userName: document.getElementById('userName').value,
                language: document.getElementById('language').value,
                dateFormat: document.getElementById('dateFormat').value,
                defaultPriority: document.getElementById('defaultPriority').value,
                defaultReminderTime: parseInt(document.getElementById('defaultReminderTime').value),
                
                // Notifications
                notifications: document.getElementById('enableBrowserNotifications').checked,
                soundEnabled: document.getElementById('enableSounds').checked,
                dailyReminders: document.getElementById('dailyReminders').checked,
                deadlineReminders: document.getElementById('deadlineReminders').checked,
                milestoneReminders: document.getElementById('milestoneReminders').checked,
                encouragementNotifications: document.getElementById('encouragementNotifications').checked,
                
                // Quiet hours
                quietHours: {
                    enabled: document.getElementById('enableQuietHours').checked,
                    start: parseInt(document.getElementById('quietHoursStart').value),
                    end: parseInt(document.getElementById('quietHoursEnd').value)
                },
                
                // Appearance
                theme: document.querySelector('input[name="theme"]:checked').value,
                compactMode: document.getElementById('compactMode').checked,
                animationsEnabled: document.getElementById('animationsEnabled').checked,
                defaultTimelineView: document.getElementById('defaultTimelineView').value,
                showCompletedTasks: document.getElementById('showCompletedTasks').checked,
                
                // Study preferences
                dailyStudyGoal: parseFloat(document.getElementById('dailyStudyGoal').value),
                weeklyStudyGoal: parseFloat(document.getElementById('weeklyStudyGoal').value),
                preferredMethods: Array.from(document.querySelectorAll('input[name="preferredMethods"]:checked'))
                    .map(cb => cb.value),
                trackStudyTime: document.getElementById('trackStudyTime').checked,
                showProgressBadges: document.getElementById('showProgressBadges').checked,
                
                // Privacy
                autoSave: document.getElementById('autoSave').checked
            };
            
            // Save to app settings
            studyApp.settings = { ...studyApp.settings, ...settings };
            studyApp.saveToStorage();
            
            // Update notification manager settings if available
            if (window.notificationManager) {
                window.notificationManager.updateSettings(settings);
            }
            
            hasUnsavedChanges = false;
            studyApp.showNotification('Settings saved successfully!', 'success');
            console.log('Settings saved:', settings);
        }

        // Apply theme
        function applyTheme(theme) {
            document.body.className = theme === 'dark' ? 'theme-dark' : '';
            
            if (theme === 'auto') {
                // Use system preference
                const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.body.className = isDark ? 'theme-dark' : '';
            }
        }

        // Toggle quiet hours settings
        function toggleQuietHoursSettings(enabled) {
            const settings = document.getElementById('quietHoursSettings');
            settings.style.display = enabled ? 'block' : 'none';
        }

        // Populate time selects
        function populateTimeSelects() {
            const timeSelects = ['quietHoursStart', 'quietHoursEnd'];
            
            timeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                
                for (let hour = 0; hour < 24; hour++) {
                    const option = document.createElement('option');
                    option.value = hour;
                    option.textContent = formatTime(hour);
                    select.appendChild(option);
                }
            });
        }

        // Format time for display
        function formatTime(hour) {
            const period = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
            return `${displayHour}:00 ${period}`;
        }

        // Populate timezone select
        function populateTimezoneSelect() {
            const select = document.getElementById('userTimezone');
            const currentTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            // Common timezones
            const timezones = [
                'America/New_York',
                'America/Chicago',
                'America/Denver',
                'America/Los_Angeles',
                'Europe/London',
                'Europe/Paris',
                'Europe/Berlin',
                'Asia/Tokyo',
                'Asia/Shanghai',
                'Asia/Kolkata',
                'Australia/Sydney',
                currentTimezone
            ];
            
            // Remove duplicates and sort
            const uniqueTimezones = [...new Set(timezones)].sort();
            
            uniqueTimezones.forEach(timezone => {
                const option = document.createElement('option');
                option.value = timezone;
                option.textContent = timezone.replace(/_/g, ' ');
                if (timezone === currentTimezone) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        // Check browser permissions
        function checkBrowserPermissions() {
            // Check notification permission
            const notificationStatus = document.getElementById('notificationPermission');
            
            if ('Notification' in window) {
                const permission = Notification.permission;
                let statusText = 'Unknown';
                let statusClass = 'warning';
                
                switch (permission) {
                    case 'granted':
                        statusText = 'Enabled';
                        statusClass = 'success';
                        break;
                    case 'denied':
                        statusText = 'Denied';
                        statusClass = 'error';
                        break;
                    case 'default':
                        statusText = 'Not Set';
                        statusClass = 'warning';
                        break;
                }
                
                notificationStatus.innerHTML = `
                    <span class="status-badge ${statusClass}">${statusText}</span>
                    ${permission !== 'granted' ? '<button class="btn btn-sm btn-secondary" onclick="requestNotificationPermission()">Enable</button>' : ''}
                `;
            } else {
                notificationStatus.innerHTML = '<span class="status-badge error">Not Supported</span>';
            }
        }

        // Request notification permission
        function requestNotificationPermission() {
            if (window.notificationManager) {
                window.notificationManager.requestNotificationPermission().then(() => {
                    setTimeout(checkBrowserPermissions, 1000);
                });
            }
        }

        // Update storage statistics
        function updateStorageStats() {
            if (window.storageManager) {
                const stats = window.storageManager.getStorageStats();
                document.getElementById('storageUsed').textContent = stats.totalSizeFormatted;
            }
            
            const planCount = studyApp.studyPlans ? studyApp.studyPlans.length : 0;
            document.getElementById('planCount').textContent = planCount;
            
            const lastBackup = localStorage.getItem('lastBackupDate');
            document.getElementById('lastBackup').textContent = lastBackup ? 
                new Date(lastBackup).toLocaleDateString() : 'Never';
        }

        // Refresh storage stats
        function refreshStorageStats() {
            updateStorageStats();
            studyApp.showNotification('Storage statistics updated', 'info');
        }

        // Export all data
        function exportAllData() {
            if (window.storageManager) {
                const success = window.storageManager.exportData();
                if (success) {
                    localStorage.setItem('lastBackupDate', new Date().toISOString());
                    updateStorageStats();
                }
            }
        }

        // Export plans only
        function exportPlansOnly() {
            const plans = studyApp.studyPlans || [];
            const exportData = {
                version: '1.0.0',
                exportDate: new Date().toISOString(),
                type: 'plans_only',
                studyPlans: plans
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `study-plans-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            studyApp.showNotification('Study plans exported successfully!', 'success');
        }

        // Handle import file
        function handleImportFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('importStatus');
            statusDiv.innerHTML = '<span class="import-loading">Importing...</span>';
            
            if (window.storageManager) {
                window.storageManager.importData(file)
                    .then((importData) => {
                        statusDiv.innerHTML = '<span class="import-success">✓ Data imported successfully!</span>';
                        studyApp.loadFromStorage(); // Reload app data
                        updateStorageStats();
                        
                        setTimeout(() => {
                            statusDiv.innerHTML = '';
                        }, 5000);
                    })
                    .catch((error) => {
                        statusDiv.innerHTML = '<span class="import-error">✗ Import failed. Please check the file format.</span>';
                        console.error('Import error:', error);
                        
                        setTimeout(() => {
                            statusDiv.innerHTML = '';
                        }, 5000);
                    });
            }
        }

        // Clear completed plans
        function clearCompletedPlans() {
            if (confirm('Are you sure you want to delete all completed study plans? This action cannot be undone.')) {
                const beforeCount = studyApp.studyPlans.length;
                studyApp.studyPlans = studyApp.studyPlans.filter(plan => plan.status !== 'completed');
                const afterCount = studyApp.studyPlans.length;
                const deletedCount = beforeCount - afterCount;
                
                studyApp.saveToStorage();
                updateStorageStats();
                
                studyApp.showNotification(
                    `${deletedCount} completed plans deleted successfully`,
                    'success'
                );
            }
        }

        // Clear all data
        function clearAllData() {
            studyApp.openModal('clearDataModal');
        }

        // Confirm clear all data
        function confirmClearAllData() {
            if (window.storageManager) {
                window.storageManager.clearAllData();
            }
            
            // Reset app state
            studyApp.studyPlans = [];
            studyApp.settings = {};
            
            studyApp.closeModal('clearDataModal');
            studyApp.showNotification('All data cleared successfully', 'success');
            
            // Reload page after a short delay
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        }

        // Reset settings to defaults
        function resetSettings() {
            studyApp.openModal('resetConfirmModal');
        }

        // Confirm reset settings
        function confirmResetSettings() {
            // Reset all form elements to defaults
            loadAllSettings(); // This will load default values
            
            studyApp.closeModal('resetConfirmModal');
            markUnsavedChanges();
            studyApp.showNotification('Settings reset to defaults', 'info');
        }
    </script>
</body>
</html>
